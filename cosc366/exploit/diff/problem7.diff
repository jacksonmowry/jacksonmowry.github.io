--- .originals/problem7.c	2023-03-03 22:16:49.000000000 +0000
+++ problem7.c	2025-03-04 13:15:49.115587338 +0000
@@ -6,6 +6,7 @@
 #include <string.h>
 
 static const int MAX_BALANCE = 2000000000;
+pthread_mutex_t account_mutex = PTHREAD_MUTEX_INITIALIZER;
 
 int accountBalance = 1000;
 
@@ -17,9 +18,11 @@
 void *withdraw(void *arg) {
   unsigned short amount = *(unsigned short *)arg;
 
+  pthread_mutex_lock(&account_mutex);
   // Ensure the user has enough money to complete this transaction
   if (amount > accountBalance) {
     printf("Insufficient funds for withdrawal of $%hu\n", amount);
+    pthread_mutex_unlock(&account_mutex);
     return NULL;
   }
 
@@ -29,6 +32,7 @@
   for (unsigned short i = 0; i < amount; i++) {
     --accountBalance;
   }
+  pthread_mutex_unlock(&account_mutex);
   return NULL;
 }
 
@@ -182,4 +186,4 @@
   if (accountBalance < -1000) {
     flag();
   }
-}
\ No newline at end of file
+}
